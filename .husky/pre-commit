#!/usr/bin/env sh

echo "Running pre-commit checks..."

# Run lint-staged for format checks and actionlint on staged files
npx lint-staged

# Check if any workflow files are staged (exclude action files - actionlint doesn't validate them)
STAGED_WORKFLOWS=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(yml|yaml)$' | grep -E '\.github/workflows/' || true)

# Run actionlint on all workflow files if any are staged (to catch cross-workflow dependencies)
# lint-staged already validated staged files, but we validate all to catch dependencies
if [ -n "$STAGED_WORKFLOWS" ]; then
  if command -v actionlint >/dev/null 2>&1; then
    echo "ğŸ” Validating all workflow files (checking dependencies)..."
    pnpm run lint:workflows || exit 1
  fi
fi

echo "âœ… All pre-commit checks passed!"
