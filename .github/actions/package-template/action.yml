name: "Package Template"
description: "Wraps, tokenizes, transforms, and packages a template into a tarball"
inputs:
  working_directory:
    description: "Directory containing the template"
    required: true
  template_name:
    description: "Name of the template (e.g., bff-template)"
    required: true
  version:
    description: "Version to package"
    required: true
  template_type:
    description: "Type of template ('web', 'core', or 'bff')"
    required: false
    default: "bff"
outputs:
  tarball_path:
    description: "Path to generated tarball"
    value: ${{ steps.pack.outputs.tarball_path }}
  tarball_name:
    description: "Name of generated tarball"
    value: ${{ steps.pack.outputs.tarball_name }}
runs:
  using: "composite"
  steps:
    - name: Run template pack utility
      uses: algtools/actions/.github/actions/template-pack-utility@main
      with:
        working_directory: ${{ inputs.working_directory }}
        template_name: ${{ inputs.template_name }}
        template_type: ${{ inputs.template_type }}

    - name: Create tarball
      id: pack
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      run: |
        set -euo pipefail

        BUILD_DIR="${{ inputs.working_directory }}/.template-build"
        DIST_DIR="${{ inputs.working_directory }}/template-dist"
        TARBALL_NAME="${{ inputs.template_name }}-v${{ inputs.version }}.tgz"
        TARBALL_PATH="template-dist/${TARBALL_NAME}"

        # Create dist directory
        mkdir -p "${DIST_DIR}"

        # Create tarball from build directory
        cd "${BUILD_DIR}"
        tar -czf "../${TARBALL_PATH}" .

        echo "tarball_path=${TARBALL_PATH}" >> $GITHUB_OUTPUT
        echo "tarball_name=${TARBALL_NAME}" >> $GITHUB_OUTPUT
        echo "âœ… Created tarball: ${TARBALL_NAME}"

    - name: Format generated files
      shell: bash
      working-directory: ${{ inputs.working_directory }}
      run: |
        echo "ðŸŽ¨ Formatting generated files..."
        pnpm run format || true
        echo "âœ… Formatting complete"
